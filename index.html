<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="utf-8" />
    <title>TOMBOLA 100% Digitale by Prizy</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta
      name="description"
      content="Bienvenue Ã  la Tombola 100% Digitale by Prizy - LÃ  oÃ¹ la chance devient rÃ©alitÃ© !"
    />
    <link rel="icon" href="favicon.ico" />
    <link rel="stylesheet" href="style.css" />
    <script src="https://unpkg.com/read-excel-file@5.x/bundle/read-excel-file.min.js"></script>
    <script
      src="https://kit.fontawesome.com/a076d05399.js"
      crossorigin="anonymous"
    ></script>
  </head>

  <body>
    <nav>
      <div class="navcontainer">
        <img style="height: 2.5rem" src="./assets/prizy.png" alt="Logo Prizy" />
        <img
          style="height: 2rem"
          src="./assets/logo-emploitic-blanc.png"
          alt="Logo talent day"
        />
      </div>
    </nav>
    <div class="container">
      <div class="cta-form">
        <h2>Tirage au sort enquÃªte Tendances RH 2024</h2>
        <!--<p>
          En collaboration avec Emploitic, Talenteo et eTalent , nous organisons
          la TOMBOLA 100% DIGITALE pour le Talent Dayâ€¦ C'est parti pour le
          tirage au sort !ðŸŽ‰
        </p>-->
      </div>
      <div class="formbold-main-wrapper">
        <div class="formbold-form-wrapper">
          <form id="form" class="w-full">
            <div class="formbold-mb-5">
              <label for="number" class="formbold-form-label">
                Nombre total de gagnants
              </label>
              <input
                type="number"
                name="number"
                id="nbwinners"
                class="formbold-form-input"
                placeholder="Saisissez le nombre de gagnants Ã  tirer au sort"
                value="3"
                min="1"
                step="1"
                required
              />
            </div>

            <div class="mb-6 pt-4">
              <label class="formbold-form-label"> Fichier </label>

              <div class="formbold-mb-5 formbold-file-input">
                <input
                  type="file"
                  name="file"
                  id="file"
                  accept=".xlsx"
                  required
                />
                <label for="file">
                  <div class="upload-area">
                    <span class="upload-area-icon">
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        xmlns:xlink="http://www.w3.org/1999/xlink"
                        width="340.531"
                        height="419.116"
                        viewBox="0 0 340.531 419.116"
                      >
                        <g id="files-new" clip-path="url(#clip-files-new)">
                          <path
                            id="Union_2"
                            data-name="Union 2"
                            d="M-2904.708-8.885A39.292,39.292,0,0,1-2944-48.177V-388.708A39.292,39.292,0,0,1-2904.708-428h209.558a13.1,13.1,0,0,1,9.3,3.8l78.584,78.584a13.1,13.1,0,0,1,3.8,9.3V-48.177a39.292,39.292,0,0,1-39.292,39.292Zm-13.1-379.823V-48.177a13.1,13.1,0,0,0,13.1,13.1h261.947a13.1,13.1,0,0,0,13.1-13.1V-323.221h-52.39a26.2,26.2,0,0,1-26.194-26.195v-52.39h-196.46A13.1,13.1,0,0,0-2917.805-388.708Zm146.5,241.621a14.269,14.269,0,0,1-7.883-12.758v-19.113h-68.841c-7.869,0-7.87-47.619,0-47.619h68.842v-18.8a14.271,14.271,0,0,1,7.882-12.758,14.239,14.239,0,0,1,14.925,1.354l57.019,42.764c.242.185.328.485.555.671a13.9,13.9,0,0,1,2.751,3.292,14.57,14.57,0,0,1,.984,1.454,14.114,14.114,0,0,1,1.411,5.987,14.006,14.006,0,0,1-1.411,5.973,14.653,14.653,0,0,1-.984,1.468,13.9,13.9,0,0,1-2.751,3.293c-.228.2-.313.485-.555.671l-57.019,42.764a14.26,14.26,0,0,1-8.558,2.847A14.326,14.326,0,0,1-2771.3-147.087Z"
                            transform="translate(2944 428)"
                            fill="#d884be"
                          />
                        </g>
                      </svg>
                    </span>

                    <span class="formbold-drop-file">
                      DÃ©posez votre fichier ici
                    </span>

                    <span class="formbold-or"
                      >Chargez un fichier (format Excel .xlsx)</span
                    >
                    <span class="formbold-browse"> Parcourir </span>
                  </div>
                </label>
              </div>
            </div>

            <div id="selected-file" style="margin-bottom: 30px"></div>

            <div>
              <input
                class="formbold-btn w-full"
                type="submit"
                value="Tirer au sort"
              />
            </div>
          </form>

          <div id="result"></div>
        </div>
      </div>
    </div>

    <div class="footer">

      <!--
      <div class="sponsorsContainer">
        <h2
          class="formbold-drop-file"
          style="color: white; font-size: 28px; font-weight: 500"
        >
          Sponsors
        </h2>

        <div class="sponsorsLogosContainer">
          <img class="formlogo" src="./assets/emploitic.png" alt="logo" />
          <img class="formlogo" src="./assets/talenteo.png" alt="logo" />
          <img class="formlogo" src="./assets/etalent.png" alt="logo" />
        </div>
      </div>
    -->

      <div class="copyrightscontainer">
        <p class="copyrights">Â© Prizy, 2023. Tous droits rÃ©servÃ©s.</p>
      </div>
    </div>

    <script>
      function getRandomInt(start, end) {
        return Math.floor(Math.random() * (end - start + 1) + start);
      }

      /*
      const prizes = [
        "https://drive.google.com/file/d/1mM_-vKM4CZgxpOg53VjJ_RLQVzhI23v8/view?usp=sharing",
        "https://drive.google.com/file/d/1AmZFiYE77FG-9xXoRMQL-j0Cn_pjkSMI/view?usp=sharing",
        "https://drive.google.com/file/d/1gxsT2wtauZWYcbRoAd1vqbs--xJNSdp7/view?usp=sharing",
      ];
      */

      const form = document.getElementById("form");
      const file = document.getElementById("file");
      const numberInput = document.getElementById("nbwinners");

      var invalidChars = ["-", "+", "e", ".", ","];

      numberInput.addEventListener("keydown", function (e) {
        if (invalidChars.includes(e.key)) {
          e.preventDefault();
        }
      });

      file.addEventListener("change", function (e) {
        e.preventDefault();
        if (e.target.files[0]) {
          const selectedfileContainer =
            document.getElementById("selected-file");
          selectedfileContainer.innerHTML = "";

          var selectedfile = document.createElement("p");
          selectedfile.className = "formbold-or";
          selectedfile.innerHTML = e.target.files[0].name;

          selectedfileContainer.append(selectedfile);
        }
      });

      form.addEventListener("submit", (e) => {
        e.preventDefault();

        const resultdiv = document.getElementById("result");

        resultdiv.innerHTML = "";
        const input = file.files[0];

        readXlsxFile(input).then((rows) => {
          const nbwinners = numberInput.valueAsNumber;

          if (nbwinners <= rows.length - 1) {
            var winnersindexes = new Set();

            var stop = false;
            while (!stop) {
              const newwinner = getRandomInt(1, rows.length - 1);
              if (!winnersindexes.has(newwinner)) {
                winnersindexes.add(newwinner);
              }
              if (winnersindexes.size == nbwinners) {
                stop = true;
              }
            }

            var resulttitle = document.createElement("div");
            resulttitle.className = "formbold-form-label formbold-form-label-2";
            resulttitle.innerHTML = "RÃ©sultats";
            resultdiv.append(resulttitle);

            var cpt = 1;
            for (const winnerindex of winnersindexes) {
              console.log(winnerindex);
              var winnerElementWrapper = document.createElement("div");
              winnerElementWrapper.className = "formbold-file-list";

              var winnerElementContent = document.createElement("div");
              winnerElementContent.className = "formbold-file-item";

              winnerElementWrapper.append(winnerElementContent);

              var winnerSpan = document.createElement("span");
              winnerSpan.className = "formbold-file-name";
              winnerSpan.innerHTML = `<b>#${cpt}</b><br/>`;
              winnerElementContent.append(winnerSpan);

              winnerSpan = document.createElement("span");
              winnerSpan.className = "formbold-file-name";
              winnerSpan.innerHTML = `<b>FÃ©licitations</b><br/>`;
              winnerElementContent.append(winnerSpan);

              for (
                var cellindex = Math.min(rows[winnerindex].length, 49);
                cellindex < Math.min(rows[winnerindex].length, 50);
                cellindex++
              ) {
                var winnerSpan = document.createElement("span");
                winnerSpan.className = "formbold-file-name";
                winnerSpan.innerHTML = `${rows[0][cellindex]} : <b>${rows[winnerindex][cellindex]}</b>`;
                winnerElementContent.append(winnerSpan);
              }

              /*
              winnerSpan = document.createElement("span");
              winnerSpan.className = "formbold-file-name";
              console.log(prizes[cpt - 1]);
              winnerSpan.innerHTML = `<br/><a href=${
                cpt <= 3 ? prizes[cpt - 1] : prizes[2]
              } target="_blank"> Click pour voir la rÃ©compense ! <i class='fas fa-angle-double-right'></a><br/>`;
              winnerElementContent.append(winnerSpan);
              */

              cpt = cpt + 1;
              resultdiv.append(winnerElementWrapper);
            }
          } else {
            var errormessage = document.createElement("p");
            errormessage.className = "formbold-form-label";
            errormessage.innerHTML =
              "*Le nombre de gagnants doit Ãªtre inferieur au nombre de participants";
            resultdiv.append(errormessage);
          }
        });
      });
    </script>
  </body>
</html>
